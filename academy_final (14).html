<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•íƒœë¦°ì˜ì–´ í•™ì› ê´€ë¦¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js" integrity="sha384-l+xbElFSnPZ2rOaPrU//2FF5B4LB8FiX5q4fXYTlfcG4PGpMkE1vcL7kNXI6Cci0" crossorigin="anonymous"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #0a0e27; color: white; }
        
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-box { background: #1a1f3a; padding: 50px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,255,136,0.3); max-width: 400px; width: 90%; }
        .login-box h1 { color: #00ff88; font-size: 32px; margin-bottom: 10px; text-align: center; }
        .login-box p { color: #a0a8c0; text-align: center; margin-bottom: 30px; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; background: #0a0e27; border: 2px solid #00ff88; border-radius: 8px; color: white; font-size: 14px; }
        .login-btn { width: 100%; padding: 15px; margin-top: 10px; background: #00ff88; border: none; border-radius: 8px; color: #0a0e27; font-weight: bold; font-size: 16px; cursor: pointer; }
        .login-btn:hover { background: #00cc66; }
        .quick-login { margin-top: 20px; text-align: center; color: #a0a8c0; font-size: 12px; }
        .quick-link { color: #00ff88; cursor: pointer; text-decoration: underline; margin: 0 5px; }
        
        .app-screen { display: none; }
        .header { background: #1a1f3a; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h2 { color: #00ff88; }
        .logout-btn { background: #ff4466; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .admin-badge { background: #ffaa00; color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; margin-left: 10px; }
        
        .tabs { background: #141937; padding: 15px 20px; display: flex; gap: 10px; overflow-x: auto; }
        .tab-btn { padding: 10px 20px; background: transparent; border: 2px solid #1a1f3a; color: #a0a8c0; border-radius: 8px; cursor: pointer; white-space: nowrap; }
        .tab-btn.active { background: #00ff88; color: #0a0e27; border-color: #00ff88; }
        
        .content { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: #1a1f3a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; color: #a0a8c0; margin-bottom: 5px; font-size: 14px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; background: #0a0e27; border: 1px solid #00ff88; border-radius: 8px; color: white; font-family: inherit; }
        .form-textarea { min-height: 100px; resize: vertical; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px; }
        .btn-primary { background: #00ff88; color: #0a0e27; }
        .btn-secondary { background: #1a1f3a; color: white; }
        .btn-danger { background: #ff4466; color: white; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        
        .student-item { background: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 2px solid transparent; display: flex; justify-content: space-between; align-items: center; }
        .student-item:hover { border-color: #00ff88; }
        .student-info { flex: 1; cursor: pointer; }
        .btn-pdf { background: #ff4466; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; margin-left: 10px; }
        .btn-pdf:hover { background: #ff2244; }
        
        .success-msg { background: rgba(0,255,136,0.1); border: 1px solid #00ff88; color: #00ff88; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .success-msg.show { display: block; }
        
        .detail-section { background: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .detail-section h4 { color: #00ff88; margin-bottom: 10px; }
        
        .progress-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }
        .progress-box { background: #1a1f3a; padding: 10px; border-radius: 5px; text-align: center; border: 2px solid #00ff88; }
        .progress-box.completed { background: #00ff88; color: #0a0e27; }
        
        .item-list { margin-top: 10px; }
        .item-row { background: #0a0e27; padding: 10px; border-radius: 5px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        
        .comment-box { background: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #00ff88; }
        .comment-date { color: #a0a8c0; font-size: 12px; margin-bottom: 5px; }
        .comment-text { color: white; line-height: 1.6; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>ğŸ« ê°•íƒœë¦°ì˜ì–´</h1>
            <p>í•™ì› ì§„ë„ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            <input type="text" id="loginUsername" class="login-input" placeholder="ì•„ì´ë””" autofocus>
            <input type="password" id="loginPassword" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="login-btn" onclick="login()">ë¡œê·¸ì¸</button>
            <div class="quick-login">
                ë¹ ë¥¸ í…ŒìŠ¤íŠ¸: 
                <span class="quick-link" onclick="quickLogin('teacher')">ì„ ìƒë‹˜</span> | 
                <span class="quick-link" onclick="quickLogin('admin')">ê´€ë¦¬ì</span>
            </div>
        </div>
    </div>

    <div id="appScreen" class="app-screen">
        <div class="header">
            <div>
                <h2>ğŸ“š ê°•íƒœë¦°ì˜ì–´ í•™ì› ê´€ë¦¬ <span id="adminBadge" class="admin-badge" style="display:none;">ADMIN</span></h2>
            </div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="tabs" id="tabs">
            <button class="tab-btn active" onclick="switchTab('students')">ì •ê·œ í•™ìƒ</button>
            <button class="tab-btn" onclick="switchTab('workshop')">íŠ¹ê°• í•™ìƒ</button>
            <button class="tab-btn" onclick="switchTab('textbooks')">êµì¬ ë“±ë¡</button>
            <button class="tab-btn" onclick="switchTab('progress')">ì§„ë„ ê´€ë¦¬</button>
            <button class="tab-btn" onclick="switchTab('evaluation')">ì„±ì  ì…ë ¥</button>
            <button class="tab-btn" onclick="switchTab('students-add')">í•™ìƒ ë“±ë¡/ì‚­ì œ</button>
            <button class="tab-btn admin-only" style="display:none;" onclick="switchTab('admin')">ê´€ë¦¬ì</button>
        </div>

        <div class="content">
            <!-- ì •ê·œ í•™ìƒ ëª©ë¡ íƒ­ -->
            <div id="tab-students" class="tab-content active">
                <div id="studentsList"></div>
                <div id="studentDetail" style="display:none;"></div>
            </div>

            <!-- íŠ¹ê°• í•™ìƒ ëª©ë¡ íƒ­ -->
            <div id="tab-workshop" class="tab-content">
                <div id="workshopStudentsList"></div>
                <div id="workshopStudentDetail" style="display:none;"></div>
            </div>

            <!-- êµì¬ ë“±ë¡ íƒ­ -->
            <div id="tab-textbooks" class="tab-content">
                <div class="card">
                    <h3>í•™ìƒë³„ êµì¬ ë“±ë¡</h3>
                    <div class="form-group">
                        <label class="form-label">í•™ìƒ ì„ íƒ</label>
                        <select id="txtStudent" class="form-select"><option value="">ì„ íƒí•˜ì„¸ìš”</option></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">êµì¬ ì„ íƒ</label>
                        <select id="txtBook" class="form-select"><option value="">ì„ íƒí•˜ì„¸ìš”</option></select>
                    </div>
                    <button class="btn btn-primary" onclick="assignTextbook()">êµì¬ ë“±ë¡</button>
                </div>
                
                <div class="card">
                    <h3>ë“±ë¡ëœ êµì¬ ëª©ë¡</h3>
                    <div class="form-group">
                        <label class="form-label">í•™ìƒ ì„ íƒ</label>
                        <select id="txtStudentView" class="form-select" onchange="viewStudentTextbooks()">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div id="studentTextbooksList"></div>
                </div>
            </div>

            <!-- ì§„ë„ ê´€ë¦¬ íƒ­ -->
            <div id="tab-progress" class="tab-content">
                <div class="card">
                    <h3>ì§„ë„ ê´€ë¦¬ (íšŒìˆ˜ë³„ í•™ìŠµ ë‚´ìš© ì…ë ¥)</h3>
                    <div class="form-group">
                        <label class="form-label">í•™ìƒ ì„ íƒ</label>
                        <select id="progStudent" class="form-select" onchange="loadProgressStudent()">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div id="progressSessions"></div>
                </div>
                
                <!-- êµì‚¬ ì½”ë©˜íŠ¸ -->
                <div class="card" id="progressCommentSection" style="display:none;">
                    <h3>êµì‚¬ ì½”ë©˜íŠ¸ (ì§„ë„ ê´€ë ¨)</h3>
                    <div class="form-group">
                        <label class="form-label">ì½”ë©˜íŠ¸ ì‘ì„±</label>
                        <textarea id="progressComment" class="form-textarea" placeholder="í•™ìƒì˜ í•™ìŠµ íƒœë„, ì´í•´ë„, ê°œì„ ì‚¬í•­ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveProgressComment()">ì½”ë©˜íŠ¸ ì €ì¥</button>
                    <div id="progressCommentList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- ì„±ì  ì…ë ¥ íƒ­ -->
            <div id="tab-evaluation" class="tab-content">
                <div class="card">
                    <h3>ì„±ì  ì…ë ¥</h3>
                    <div class="form-group">
                        <label class="form-label">í•™ìƒ</label>
                        <select id="evalStudent" class="form-select" onchange="loadEvalComments()"></select>
                    </div>
                    
                    <!-- í•™êµ ì‹œí—˜ -->
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #5c6bc0;">
                        <h4 style="color: #5c6bc0; margin-bottom: 15px;">ğŸ« í•™êµ ì‹œí—˜</h4>
                        <div class="form-group">
                            <label class="form-label">ì‹œí—˜ êµ¬ë¶„</label>
                            <select id="schoolExamType" class="form-select">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="1í•™ê¸° ì¤‘ê°„ê³ ì‚¬">1í•™ê¸° ì¤‘ê°„ê³ ì‚¬</option>
                                <option value="1í•™ê¸° ê¸°ë§ê³ ì‚¬">1í•™ê¸° ê¸°ë§ê³ ì‚¬</option>
                                <option value="2í•™ê¸° ì¤‘ê°„ê³ ì‚¬">2í•™ê¸° ì¤‘ê°„ê³ ì‚¬</option>
                                <option value="2í•™ê¸° ê¸°ë§ê³ ì‚¬">2í•™ê¸° ê¸°ë§ê³ ì‚¬</option>
                                <option value="ìˆ˜í–‰í‰ê°€">ìˆ˜í–‰í‰ê°€</option>
                                <option value="ëª¨ì˜ê³ ì‚¬">ëª¨ì˜ê³ ì‚¬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì ìˆ˜</label>
                            <input type="number" id="schoolExamScore" class="form-input" placeholder="0-100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë‚ ì§œ</label>
                            <input type="date" id="schoolExamDate" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <button class="btn btn-primary" onclick="saveSchoolExam()">í•™êµ ì‹œí—˜ ì €ì¥</button>
                    </div>
                    
                    <!-- í•™ì› TEST -->
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #00ff88;">
                        <h4 style="color: #00ff88; margin-bottom: 15px;">ğŸ“ í•™ì› TEST</h4>
                        <div class="form-group">
                            <label class="form-label">TEST êµ¬ë¶„</label>
                            <select id="academyTestType" class="form-select">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì¤‘ë“±ì˜¬ë°±Test">ì¤‘ë“±ì˜¬ë°±Test</option>
                                <option value="êµì¬ì„±ì·¨ë„í‰ê°€">êµì¬ì„±ì·¨ë„í‰ê°€</option>
                                <option value="NELTì˜ì–´í•™ë ¥í‰ê°€">NELTì˜ì–´í•™ë ¥í‰ê°€</option>
                                <option value="VOCAëŒ€íšŒ">VOCAëŒ€íšŒ</option>
                                <option value="ë¬¸ë²•TEST">ë¬¸ë²•TEST</option>
                                <option value="ë…í•´TEST">ë…í•´TEST</option>
                                <option value="ë‹¨ì–´TEST">ë‹¨ì–´TEST</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì ìˆ˜</label>
                            <input type="number" id="academyTestScore" class="form-input" placeholder="0-100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë‚ ì§œ</label>
                            <input type="date" id="academyTestDate" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <button class="btn btn-primary" onclick="saveAcademyTest()">í•™ì› TEST ì €ì¥</button>
                    </div>
                </div>
                
                <!-- ë“±ë¡ëœ ì„±ì  ëª©ë¡ -->
                <div class="card" id="evalListSection" style="display:none;">
                    <h3>ë“±ë¡ëœ ì„±ì </h3>
                    <div id="evalList"></div>
                </div>
                
                <!-- êµì‚¬ ì½”ë©˜íŠ¸ -->
                <div class="card" id="evalCommentSection" style="display:none;">
                    <h3>êµì‚¬ ì½”ë©˜íŠ¸ (ì„±ì  ê´€ë ¨)</h3>
                    <div class="form-group">
                        <label class="form-label">ì½”ë©˜íŠ¸ ì‘ì„±</label>
                        <textarea id="evalComment" class="form-textarea" placeholder="ì‹œí—˜ ê²°ê³¼ì— ëŒ€í•œ ì´í‰, ê°•ì , ë³´ì™„ì  ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveEvalComment()">ì½”ë©˜íŠ¸ ì €ì¥</button>
                    <div id="evalCommentList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- í•™ìƒ ë“±ë¡/ì‚­ì œ íƒ­ -->
            <div id="tab-students-add" class="tab-content">
                <div class="card">
                    <h3>í•™ìƒ ë“±ë¡</h3>
                    <div id="addSuccess" class="success-msg">âœ“ í•™ìƒì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                    <div class="form-group">
                        <label class="form-label">ì´ë¦„</label>
                        <input type="text" id="addName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">í•™ë…„</label>
                        <input type="text" id="addGrade" class="form-input" placeholder="ì˜ˆ: ì´ˆ5, ì¤‘2">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì£¼ ë“±ë¡ íšŸìˆ˜</label>
                        <select id="addFreq" class="form-select">
                            <option value="2">ì£¼ 2íšŒ (ì›” 8íšŒ)</option>
                            <option value="3" selected>ì£¼ 3íšŒ (ì›” 12íšŒ)</option>
                            <option value="íŠ¹ê°•4">íŠ¹ê°• 4íšŒ</option>
                            <option value="íŠ¹ê°•8">íŠ¹ê°• 8íšŒ</option>
                            <option value="íŠ¹ê°•12">íŠ¹ê°• 12íšŒ</option>
                            <option value="íŠ¹ê°•16">íŠ¹ê°• 16íšŒ</option>
                            <option value="íŠ¹ê°•20">íŠ¹ê°• 20íšŒ</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addStudent()">í•™ìƒ ë“±ë¡</button>
                </div>
                
                <div class="card">
                    <h3>í•™ìƒ ì‚­ì œ</h3>
                    <div class="form-group">
                        <label class="form-label">ì‚­ì œí•  í•™ìƒ ì„ íƒ</label>
                        <select id="deleteStudent" class="form-select"></select>
                    </div>
                    <button class="btn btn-danger" onclick="deleteStudent()">í•™ìƒ ì‚­ì œ</button>
                </div>
            </div>

            <!-- ê´€ë¦¬ì íƒ­ -->
            <div id="tab-admin" class="tab-content">
                <div class="card">
                    <h3>ğŸ“¦ ë°ì´í„° ë°±ì—… & ë³µì›</h3>
                    <p style="color: #a0a8c0; margin-bottom: 15px;">ëª¨ë“  ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <button class="btn btn-primary" onclick="exportData()">ğŸ’¾ ë°ì´í„° ë°±ì—… (ë‹¤ìš´ë¡œë“œ)</button>
                    <button class="btn btn-secondary" onclick="showDataText()">ğŸ“‹ ë°ì´í„° ë³´ê¸°</button>
                    <div id="dataDisplay" style="display:none; margin-top: 20px;">
                        <textarea id="dataTextarea" class="form-textarea" style="min-height: 200px; font-size: 11px;" readonly></textarea>
                        <button class="btn btn-primary" onclick="copyData()">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>êµì¬ ê´€ë¦¬</h3>
                    <div class="form-group">
                        <label class="form-label">êµì¬ëª…</label>
                        <input type="text" id="adminBookTitle" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì´ Unit ìˆ˜</label>
                        <input type="number" id="adminBookUnits" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="addTextbook()">êµì¬ ì¶”ê°€</button>
                    <div id="textbooksList" class="item-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const USERS = {
            'teacher': { password: 'teacher123', role: 'teacher' },
            'admin': { password: 'admin123', role: 'admin' }
        };
        
        let currentUser = null;
        
        const DB = {
            students: [
                { id: 4, name: 'ê¹€ì€ì„±', grade: 'ì¤‘2', weeklyFreq: 3 },
                { id: 5, name: 'ì§€ìœ¤ì£¼', grade: 'ì¤‘1', weeklyFreq: 3 },
                { id: 6, name: 'ê¹€ë„ì—°', grade: 'ì¤‘2', weeklyFreq: 3 },
                { id: 8, name: 'ì´ì‹œìš°', grade: 'ì´ˆ2', weeklyFreq: 2 },
                { id: 9, name: 'ê¹€ë¦¬í˜„', grade: 'ì´ˆ2', weeklyFreq: 2 },
                { id: 10, name: 'ë°°ì„±ì¤€', grade: 'ì´ˆ2', weeklyFreq: 2 },
                { id: 11, name: 'ë°•ì°¨ìŒ', grade: 'ì´ˆ3', weeklyFreq: 2 },
                { id: 12, name: 'ìœ¤ë„ì—½', grade: 'ì´ˆ3', weeklyFreq: 3 },
                { id: 13, name: 'ê¹€ë„ì—°', grade: 'ì´ˆ4', weeklyFreq: 3 },
                { id: 14, name: 'ì¡°ì„œì—°', grade: 'ì´ˆ4', weeklyFreq: 3 },
                { id: 15, name: 'ë³€ì¤€í˜', grade: 'ì´ˆ4', weeklyFreq: 2 },
                { id: 16, name: 'ì •ì€ì„œ', grade: 'ì´ˆ5', weeklyFreq: 3 },
                { id: 17, name: 'í™©ì£¼ì›', grade: 'ì´ˆ5', weeklyFreq: 3 },
                { id: 18, name: 'ê°•í•˜ì€', grade: 'ì´ˆ5', weeklyFreq: 3 },
                { id: 19, name: 'ê¹€ì§€ì•„', grade: 'ì´ˆ5', weeklyFreq: 2 },
                { id: 20, name: 'ì¡°ë¯¼êµ¬', grade: 'ì´ˆ5', weeklyFreq: 2 },
                { id: 21, name: 'ìµœì¬ìœ¤', grade: 'ì´ˆ5', weeklyFreq: 2 },
                { id: 22, name: 'ë°•ê·œë¹ˆ', grade: 'ì´ˆ2', weeklyFreq: 2 },
                { id: 23, name: 'ë°•ì‹œìš°', grade: 'ì´ˆ6', weeklyFreq: 2 },
                { id: 24, name: 'ê¹€ë„í›ˆ', grade: 'ì´ˆ6', weeklyFreq: 2 },
                { id: 25, name: 'ê¹€ë ¹ì€', grade: 'ì´ˆ6', weeklyFreq: 3 },
                { id: 26, name: 'í™©ì¸í˜¸', grade: 'ì´ˆ6', weeklyFreq: 3 },
                { id: 27, name: 'ë°°ì •í•˜', grade: 'ì´ˆ6', weeklyFreq: 3 },
                { id: 28, name: 'í™©ì„œì•„', grade: 'ì´ˆ5', weeklyFreq: 3 },
                { id: 29, name: 'ìµœê´‘í˜„', grade: 'ì´ˆ6', weeklyFreq: 3 },
                { id: 30, name: 'ì´ì£¼í˜¸', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 31, name: 'ê¹€ëŒ€ì—°', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 32, name: 'ì´ì˜í˜„', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 33, name: 'ë°•ì€í¬', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 34, name: 'ì •ìœ¤', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 35, name: 'ì •ìš°ì¤€', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 36, name: 'ê¹€í•˜ëŒ', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 37, name: 'ê°•ìš°ì§„', grade: 'ì¤‘1', weeklyFreq: 2 },
                { id: 38, name: 'ì´ê°€ì—°', grade: 'ì¤‘3', weeklyFreq: 2 },
                { id: 39, name: 'ê¹€ë„í˜„', grade: 'ì¤‘3', weeklyFreq: 2 },
                { id: 40, name: 'ìœ ì‹œí˜„', grade: 'ì¤‘2', weeklyFreq: 2 },
                { id: 41, name: 'ìµœí¬ì›', grade: 'ì¤‘2', weeklyFreq: 2 },
                { id: 42, name: 'ê¹€ë‚˜ì—°', grade: 'ì¤‘2', weeklyFreq: 3 }
            ],
            textbooks: [
                { id: 1, title: 'ë‚´ì‹ ì½˜ì„œíŠ¸  ëŠ¥ë¥  ê¹€ê¸°íƒ ë‘ì¼ì¤‘ 2', units: 4 },
                { id: 2, title: 'ë‚´ì‹ ì½˜ì„œíŠ¸ ë™ì•„ ìœ¤ì •ë¯¸ êµí•˜ì¤‘2', units: 4 },
                { id: 3, title: 'ë‚´ì‹ ì½˜ì„œíŠ¸ ë¯¸ë˜ì—” ìµœì—°í¬ ë‘ì¼ì¤‘3', units: 4 },
                { id: 4, title: 'ê·¸ë˜ë¨¸ì¸ì‚¬ì´ë“œ ìŠ¤íƒ€í„°', units: 12 },
                { id: 5, title: 'ê·¸ë˜ë¨¸ì¸ì‚¬ì´ë“œ ë ˆë²¨1', units: 12 },
                { id: 6, title: 'ì˜ë¬¸ë²•ê³µì‹ A', units: 22 },
                { id: 7, title: 'ì˜ë¬¸ë²•ê³µì‹ B', units: 22 },
                { id: 8, title: 'ì˜ˆë¹„ì¤‘ë“± 3800ì œ ìŠ¤íƒ€í„°', units: 13 },
                { id: 9, title: 'ì´ˆë“±800ë‹¨ì–´', units: 81 },
                { id: 10, title: 'ì¤‘ë“±VOCA ì…ë¬¸', units: 45 },
                { id: 11, title: 'ì¤‘ë“±VOCA ê¸°ë³¸', units: 45 },
                { id: 12, title: 'ì¤‘ë“±VOCA ì‹¤ë ¥', units: 45 },
                { id: 13, title: 'ì²œì¼ë¬¸ ê·¸ë˜ë¨¸ LEVE 2', units: 12 },
                { id: 14, title: 'ì²œì¼ë¬¸ WRITNG 2', units: 10 },
                { id: 15, title: 'ì²œì¼ë¬¸ WRITNG 3', units: 11 },
                { id: 16, title: 'ë¯¸ë¦¬ìˆ˜ëŠ¥ì˜ì–´ ê¸°ì´ˆë…í•´', units: 16 },
                { id: 17, title: 'ë‚´ì‹ ì½˜ì„œíŠ¸ ë™ì•„ ì´ë³‘ë¯¼ í™”ìˆ˜ì¤‘ 2', units: 4 },
                { id: 18, title: '4SKIL ENGLISH LEVEL A', units: 6 },
                { id: 19, title: '4SKIL ENGLISH LEVEL B', units: 6 },
                { id: 20, title: '4SKIL ENGLISH LEVEL C', units: 6 },
                { id: 21, title: '4SKIL ENGLISH LEVEL D', units: 6 },
                { id: 22, title: '4SKIL ENGLISH LEVEL E', units: 6 },
                { id: 23, title: '4SKIL ENGLISH LEVEL F', units: 6 },
                { id: 24, title: '4SKIL ENGLISH LEVEL G', units: 6 },
                { id: 25, title: '4SKIL ENGLISH LEVEL H', units: 6 },
                { id: 26, title: '4SKIL ENGLISH LEVEL I', units: 6 },
                { id: 27, title: '4SKIL ENGLISH LEVEL J', units: 6 },
                { id: 28, title: '4SKIL ENGLISH LEVEL K', units: 6 },
                { id: 29, title: '4SKIL ENGLISH LEVEL L', units: 6 },
                { id: 30, title: 'VOCA MASTER LEVEL 1', units: 6 },
                { id: 31, title: 'VOCA MASTER LEVEL 2', units: 6 },
                { id: 32, title: 'VOCA MASTER LEVEL 3', units: 6 },
                { id: 33, title: 'VOCA MASTER LEVEL 4', units: 6 },
                { id: 34, title: 'ì‹œì›ìŠ¤ì¿¨ ê¸°ì´ˆ ì˜ë¬¸ë²• 1', units: 20 },
                { id: 35, title: 'ì‹œì›ìŠ¤ì¿¨ ê¸°ì´ˆ ì˜ë¬¸ë²• 2', units: 20 },
                { id: 36, title: 'SOUNDS GREART 1', units: 8 },
                { id: 37, title: 'SOUNDS GREART 2', units: 8 },
                { id: 38, title: 'READING FUTURE 1', units: 16 },
                { id: 39, title: 'READING FUTURE 2', units: 16 },
                { id: 40, title: 'READING FUTURE 3', units: 16 },
                { id: 41, title: 'SUPER EASY READING 1', units: 16 },
                { id: 42, title: 'SUPER EASY READING 2', units: 16 },
                { id: 43, title: 'SUPER EASY READING 3', units: 16 },
                { id: 44, title: 'VERY EASY READING 2', units: 16 },
                { id: 45, title: 'VERY EASY READING 3', units: 16 },
                { id: 46, title: 'VERY EASY READING 4', units: 16 },
                { id: 47, title: 'BASIC READING 800  LEVEL 1', units: 16 },
                { id: 48, title: 'BASIC READING 800  LEVEL 2', units: 16 },
                { id: 49, title: 'BASIC READING 800  LEVEL 3', units: 16 },
                { id: 50, title: 'BASIC READING 1200  LEVEL 1', units: 16 },
                { id: 51, title: 'BASIC READING 1200  LEVEL 2', units: 16 },
                { id: 52, title: 'BASIC READING 1200  LEVEL 3', units: 16 },
                { id: 53, title: 'ìŠ¤ë§ˆíŠ¸ì˜¬ì¤‘í•™(ì¸í„°ë„·ê°•ì˜)', units: 1 }
            ],
            studentTextbooks: [
                { studentId: 4, textbookId: 1 },
                { studentId: 4, textbookId: 12 },
                { studentId: 4, textbookId: 14 },
                { studentId: 5, textbookId: 4 },
                { studentId: 5, textbookId: 9 },
                { studentId: 5, textbookId: 10 },
                { studentId: 6, textbookId: 10 },
                { studentId: 6, textbookId: 2 },
                { studentId: 6, textbookId: 5 },
                { studentId: 4, textbookId: 53 },
                { studentId: 8, textbookId: 18 },
                { studentId: 12, textbookId: 19 },
                { studentId: 12, textbookId: 38 },
                { studentId: 12, textbookId: 31 },
                { studentId: 17, textbookId: 20 }
            ],
            progress: [
                { studentId: 5, sessionNum: 1, content: 'ëª…ì‚¬', date: '2026-02-02' },
                { studentId: 5, sessionNum: 2, content: 'BEë™ì‚¬', date: '2026-02-04' },
                { studentId: 5, sessionNum: 3, content: 'ëª…ì‚¬~BEë™ì‚¬ ì˜¬ë°±TEST', date: '2026-02-06' },
                { studentId: 42, sessionNum: 1, content: 'êµí†µì‚¬ê³ ì…ì›', date: '2026-02-03' },
                { studentId: 42, sessionNum: 2, content: 'êµí†µì‚¬ê³ ì…ì›', date: '2026-02-04' },
                { studentId: 42, sessionNum: 3, content: 'êµí†µì‚¬ê³ ì…ì›', date: '2026-02-06' },
                { studentId: 23, sessionNum: 1, content: 'ì¼ë°˜ë™ì‚¬ AFTER TEST ì˜¤ë‹µì •ë¦¬', date: '2026-02-03' },
                { studentId: 23, sessionNum: 2, content: 'ì˜ë¬¸ë²•ê³µì‹ B - ì¡°ë™ì‚¬ ëª…ë ¹ë¬¸ ì œì•ˆë¬¸', date: '2026-02-06' },
                { studentId: 6, sessionNum: 1, content: 'ìˆ˜ë™íƒœ', date: '2026-02-03' },
                { studentId: 6, sessionNum: 2, content: 'ìˆ˜ë™íƒœ  ë¬¸ì œ í’€ì´', date: '2026-02-07' },
                { studentId: 6, sessionNum: 3, content: 'ìˆ˜ë™íƒœ ë¬¸ì œ í’€ì´', date: '2026-02-06' }
            ],
            evaluations: [
                { studentId: 5, type: 'ì¤‘ë“±ì˜¬ë°±Test', date: '2026-02-06', score: 67 },
                { studentId: 5, type: 'ì¤‘ë“±ì˜¬ë°±Test', date: '2026-02-06', score: 67 }
            ],
            comments: [
                { id: 1, studentId: 6, type: 'progress', comment: '2íšŒì°¨ ìˆ˜ì—…ì—ì„œ ë¬¸ì œ í’€ì´ ìˆ™ì œë¥¼ ë‹¤ ëª» í•´ì™€ì„œ 3íšŒì°¨ ìˆ˜ì—…ì‹œê°„ì— í’€ì´í•¨', date: '2026-02-07' }
            ]
        };
        
        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const user = USERS[username];
            if (user && user.password === password) {
                currentUser = { username, role: user.role };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showApp();
            } else {
                alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
        }
        
        function quickLogin(role) {
            document.getElementById('loginUsername').value = role;
            document.getElementById('loginPassword').value = role + '123';
            login();
        }
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appScreen').style.display = 'none';
        }
        
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            if (currentUser.role === 'admin') {
                document.getElementById('adminBadge').style.display = 'inline-block';
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'inline-block');
            }
            renderStudentsList();
            loadData();
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
            
            if (tabName === 'students') renderStudentsList();
            if (tabName === 'workshop') renderWorkshopStudentsList();
            if (tabName === 'textbooks') loadTextbookTab();
            if (tabName === 'progress') loadProgressTab();
            if (tabName === 'evaluation') loadEvalTab();
            if (tabName === 'students-add') loadStudentManageTab();
            if (tabName === 'admin') loadAdminTab();
        }
        
        function renderStudentsList() {
            document.getElementById('studentDetail').style.display = 'none';
            document.getElementById('studentsList').style.display = 'block';
            const regularStudents = getRegularStudents();
            const html = regularStudents.map(s => `
                <div class="student-item">
                    <div class="student-info" onclick="viewStudentDetail(${s.id})">
                        <strong>${s.name}</strong> (${s.grade}) - ${getFrequencyLabel(s.weeklyFreq)} (${getSessionCount(s.weeklyFreq)}íšŒ)
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-pdf" onclick="event.stopPropagation(); generateMonthlyReport(${s.id})">ğŸ“„ PDF</button>
                        <button class="btn-pdf" style="background: #FEE500; color: #000;" onclick="event.stopPropagation(); shareToKakao(${s.id})">ğŸ’¬ ì¹´í†¡</button>
                    </div>
                </div>
            `).join('');
            document.getElementById('studentsList').innerHTML = html || '<p>ë“±ë¡ëœ ì •ê·œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
        }
        
        function renderWorkshopStudentsList() {
            document.getElementById('workshopStudentDetail').style.display = 'none';
            document.getElementById('workshopStudentsList').style.display = 'block';
            const workshopStudents = getWorkshopStudents();
            const html = workshopStudents.map(s => `
                <div class="student-item">
                    <div class="student-info" onclick="viewWorkshopStudentDetail(${s.id})">
                        <strong>${s.name}</strong> (${s.grade}) - ${getFrequencyLabel(s.weeklyFreq)} (${getSessionCount(s.weeklyFreq)}íšŒ)
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-pdf" onclick="event.stopPropagation(); generateWorkshopReport(${s.id})">ğŸ“„ PDF</button>
                        <button class="btn-pdf" style="background: #FEE500; color: #000;" onclick="event.stopPropagation(); shareToKakao(${s.id})">ğŸ’¬ ì¹´í†¡</button>
                    </div>
                </div>
            `).join('');
            document.getElementById('workshopStudentsList').innerHTML = html || '<p>ë“±ë¡ëœ íŠ¹ê°• í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
        }
        
        function viewStudentDetail(studentId) {
            const student = DB.students.find(s => s.id === studentId);
            const studentBooks = DB.studentTextbooks
                .filter(st => st.studentId === studentId)
                .map(st => DB.textbooks.find(t => t.id === st.textbookId))
                .filter(Boolean);
            const studentProgress = DB.progress.filter(p => p.studentId === studentId);
            const studentEvals = DB.evaluations.filter(e => e.studentId === studentId);
            const studentComments = DB.comments.filter(c => c.studentId === studentId);
            
            // ìµœê·¼ ì§„ë„ (ìµœê·¼ 5ê°œ)
            const recentProgress = studentProgress.slice(-5).reverse();
            
            // ìµœê·¼ ì„±ì  (ìµœê·¼ 5ê°œ)
            const recentEvals = studentEvals.slice(-5).reverse();
            
            // í‰ê·  ì ìˆ˜ ê³„ì‚°
            const avgScore = studentEvals.length > 0 
                ? Math.round(studentEvals.reduce((sum, e) => sum + e.score, 0) / studentEvals.length) 
                : 0;
            
            let html = `
                <div class="card">
                    <button class="btn btn-secondary btn-small" onclick="renderStudentsList()">â† ëª©ë¡ìœ¼ë¡œ</button>
                    
                    <!-- í•™ìƒ ê¸°ë³¸ ì •ë³´ í—¤ë” -->
                    <div style="background: linear-gradient(135deg, #1a237e 0%, #283593 100%); padding: 30px; border-radius: 10px; margin: 20px 0; color: white;">
                        <h1 style="font-size: 32px; margin-bottom: 10px;">${student.name}</h1>
                        <div style="display: flex; gap: 30px; flex-wrap: wrap; margin-top: 20px;">
                            <div>
                                <div style="color: #a0c8ff; font-size: 12px;">í•™ë…„</div>
                                <div style="font-size: 24px; font-weight: bold;">${student.grade}</div>
                            </div>
                            <div>
                                <div style="color: #a0c8ff; font-size: 12px;">ë“±ë¡ ìœ í˜•</div>
                                <div style="font-size: 24px; font-weight: bold;">${getFrequencyLabel(student.weeklyFreq)}</div>
                            </div>
                            <div>
                                <div style="color: #a0c8ff; font-size: 12px;">ì›” ìˆ˜ì—…</div>
                                <div style="font-size: 24px; font-weight: bold;">${getSessionCount(student.weeklyFreq)}íšŒ</div>
                            </div>
                            <div>
                                <div style="color: #a0c8ff; font-size: 12px;">í‰ê·  ì ìˆ˜</div>
                                <div style="font-size: 24px; font-weight: bold; color: ${avgScore >= 90 ? '#00ff88' : avgScore >= 80 ? '#ffd700' : '#ff4466'};">${avgScore}ì </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        
                        <!-- ë“±ë¡ êµì¬ -->
                        <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #00ff88;">
                            <h3 style="color: #00ff88; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                ğŸ“š ë“±ë¡ êµì¬
                                <span style="background: #00ff88; color: #0a0e27; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentBooks.length}</span>
                            </h3>
                            ${studentBooks.length > 0 ? studentBooks.map(b => `
                                <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #00ff88;">
                                    <div style="font-weight: bold; margin-bottom: 3px;">${b.title}</div>
                                    <div style="color: #a0a8c0; font-size: 12px;">${b.units} units</div>
                                </div>
                            `).join('') : '<p style="color: #a0a8c0;">ë“±ë¡ëœ êµì¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                        </div>
                        
                        <!-- ìµœê·¼ ì§„ë„ -->
                        <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #5c6bc0;">
                            <h3 style="color: #5c6bc0; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                ğŸ“– ìµœê·¼ ì§„ë„
                                <span style="background: #5c6bc0; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentProgress.length}</span>
                            </h3>
                            ${recentProgress.length > 0 ? recentProgress.map(p => `
                                <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #5c6bc0;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px;">
                                        <span style="background: #5c6bc0; color: white; padding: 2px 8px; border-radius: 5px; font-size: 11px; font-weight: bold;">${p.sessionNum}íšŒì°¨</span>
                                        <span style="color: #a0a8c0; font-size: 11px;">${p.date}</span>
                                    </div>
                                    ${p.textbookTitle ? `<div style="color: #00ff88; font-size: 11px; margin-bottom: 3px;">ğŸ“š ${p.textbookTitle}</div>` : ''}
                                    <div style="color: white; font-size: 13px; line-height: 1.4;">${p.content}</div>
                                </div>
                            `).join('') : '<p style="color: #a0a8c0;">ì§„ë„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                            ${studentProgress.length > 5 ? `<div style="text-align: center; margin-top: 10px; color: #5c6bc0; font-size: 12px;">ì™¸ ${studentProgress.length - 5}ê°œ ë”ë³´ê¸°</div>` : ''}
                        </div>
                        
                        <!-- ìµœê·¼ í…ŒìŠ¤íŠ¸ -->
                        <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #ff4466;">
                            <h3 style="color: #ff4466; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                ğŸ“Š ìµœê·¼ í…ŒìŠ¤íŠ¸
                                <span style="background: #ff4466; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentEvals.length}</span>
                            </h3>
                            ${recentEvals.length > 0 ? recentEvals.map(e => `
                                <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #ff4466;">
                                    ${e.category ? `<div style="color: #a0c8ff; font-size: 11px; margin-bottom: 3px;">${e.category}</div>` : ''}
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <span style="color: white; font-weight: bold; font-size: 13px;">${e.type}</span>
                                        <span style="background: ${e.score >= 90 ? '#00ff88' : e.score >= 80 ? '#ffd700' : '#ff4466'}; color: ${e.score >= 80 ? '#0a0e27' : 'white'}; padding: 3px 10px; border-radius: 5px; font-weight: bold; font-size: 14px;">${e.score}ì </span>
                                    </div>
                                    <div style="color: #a0a8c0; font-size: 11px;">${e.date}</div>
                                </div>
                            `).join('') : '<p style="color: #a0a8c0;">ì„±ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                            ${studentEvals.length > 5 ? `<div style="text-align: center; margin-top: 10px; color: #ff4466; font-size: 12px;">ì™¸ ${studentEvals.length - 5}ê°œ ë”ë³´ê¸°</div>` : ''}
                        </div>
                    </div>
                    
                    <!-- êµì‚¬ ì½”ë©˜íŠ¸ -->
                    ${studentComments.length > 0 ? `
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; margin-top: 20px; border: 2px solid #ffaa00;">
                        <h3 style="color: #ffaa00; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            ğŸ’¬ êµì‚¬ ì½”ë©˜íŠ¸
                            <span style="background: #ffaa00; color: #0a0e27; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentComments.length}</span>
                        </h3>
                        ${studentComments.slice(-3).reverse().map(c => `
                            <div style="background: #1a1f3a; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #ffaa00;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span style="background: ${c.type === 'progress' ? '#5c6bc0' : '#ff4466'}; color: white; padding: 3px 10px; border-radius: 5px; font-size: 11px;">
                                        ${c.type === 'progress' ? 'ì§„ë„ ê´€ë ¨' : 'ì„±ì  ê´€ë ¨'}
                                    </span>
                                    <span style="color: #a0a8c0; font-size: 11px;">${c.date}</span>
                                </div>
                                <div style="color: white; line-height: 1.6; font-size: 14px;">${c.comment}</div>
                            </div>
                        `).join('')}
                        ${studentComments.length > 3 ? `<div style="text-align: center; margin-top: 10px; color: #ffaa00; font-size: 12px;">ì™¸ ${studentComments.length - 3}ê°œ ë”ë³´ê¸°</div>` : ''}
                    </div>
                    ` : ''}
                    
                    <!-- í†µê³„ ìš”ì•½ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="color: rgba(0,0,0,0.7); font-size: 12px; margin-bottom: 5px;">ì´ ì§„ë„</div>
                            <div style="color: #0a0e27; font-size: 32px; font-weight: bold;">${studentProgress.length}íšŒ</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff4466 0%, #cc3355 100%); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 5px;">ì´ í…ŒìŠ¤íŠ¸</div>
                            <div style="color: white; font-size: 32px; font-weight: bold;">${studentEvals.length}íšŒ</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 5px;">í‰ê·  ì ìˆ˜</div>
                            <div style="color: white; font-size: 32px; font-weight: bold;">${avgScore}ì </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="color: rgba(0,0,0,0.7); font-size: 12px; margin-bottom: 5px;">ì½”ë©˜íŠ¸</div>
                            <div style="color: #0a0e27; font-size: 32px; font-weight: bold;">${studentComments.length}ê°œ</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('studentsList').style.display = 'none';
            document.getElementById('studentDetail').innerHTML = html;
            document.getElementById('studentDetail').style.display = 'block';
        }
        
        function viewWorkshopStudentDetail(studentId) {
            const student = DB.students.find(s => s.id === studentId);
            const studentBooks = DB.studentTextbooks
                .filter(st => st.studentId === studentId)
                .map(st => DB.textbooks.find(t => t.id === st.textbookId))
                .filter(Boolean);
            const studentProgress = DB.progress.filter(p => p.studentId === studentId);
            const studentEvals = DB.evaluations.filter(e => e.studentId === studentId);
            const studentComments = DB.comments.filter(c => c.studentId === studentId);
            
            const recentProgress = studentProgress.slice(-5).reverse();
            const recentEvals = studentEvals.slice(-5).reverse();
            const avgScore = studentEvals.length > 0 
                ? Math.round(studentEvals.reduce((sum, e) => sum + e.score, 0) / studentEvals.length) 
                : 0;
            
            const avgColor = avgScore >= 90 ? '#00ff88' : avgScore >= 80 ? '#ffd700' : '#ff4466';
            
            const html = `
                <button class="btn-back" onclick="renderWorkshopStudentsList()" style="margin-bottom: 20px;">â† íŠ¹ê°• í•™ìƒ ëª©ë¡ìœ¼ë¡œ</button>
                
                <div style="background: linear-gradient(135deg, #1a237e 0%, #283593 100%); padding: 40px; border-radius: 15px; color: white; margin-bottom: 30px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);">
                    <h2 style="margin: 0 0 30px 0; font-size: 36px; font-weight: 900;">${student.name}</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                        <div>
                            <div style="color: #a0c8ff; font-size: 12px;">í•™ë…„</div>
                            <div style="font-size: 24px; font-weight: bold;">${student.grade}</div>
                        </div>
                        <div>
                            <div style="color: #a0c8ff; font-size: 12px;">íŠ¹ê°• ìœ í˜•</div>
                            <div style="font-size: 24px; font-weight: bold;">${getFrequencyLabel(student.weeklyFreq)}</div>
                        </div>
                        <div>
                            <div style="color: #a0c8ff; font-size: 12px;">ì´ ìˆ˜ì—…</div>
                            <div style="font-size: 24px; font-weight: bold;">${getSessionCount(student.weeklyFreq)}íšŒ</div>
                        </div>
                        <div>
                            <div style="color: #a0c8ff; font-size: 12px;">í‰ê·  ì ìˆ˜</div>
                            <div style="font-size: 24px; font-weight: bold; color: ${avgColor};">${avgScore}ì </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #00ff88;">
                        <h3 style="color: #00ff88; margin-bottom: 15px;">ğŸ“š ë“±ë¡ êµì¬ <span style="background: #00ff88; color: #0a0e27; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentBooks.length}</span></h3>
                        ${studentBooks.length > 0 ? studentBooks.map(b => `
                            <div style="background: #1a1f3a; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #00ff88;">
                                <strong>${b.title}</strong><br>
                                <span style="color: #a0a8c0; font-size: 11px;">${b.units} units</span>
                            </div>
                        `).join('') : '<p style="color: #a0a8c0;">ë“±ë¡ëœ êµì¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                    
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #5c6bc0;">
                        <h3 style="color: #5c6bc0; margin-bottom: 15px;">ğŸ“– ìµœê·¼ ì§„ë„ <span style="background: #5c6bc0; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentProgress.length}</span></h3>
                        ${recentProgress.length > 0 ? recentProgress.map(p => `
                            <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #5c6bc0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="background: #5c6bc0; color: white; padding: 2px 8px; border-radius: 5px; font-size: 11px;">${p.sessionNum}íšŒ</span>
                                    <span style="color: #a0a8c0; font-size: 11px;">${p.date}</span>
                                </div>
                                ${p.textbookTitle ? `<div style="color: #00ff88; font-size: 11px; margin-bottom: 3px;">ğŸ“š ${p.textbookTitle}</div>` : ''}
                                <div style="color: white; font-size: 13px;">${p.content}</div>
                            </div>
                        `).join('') : '<p style="color: #a0a8c0;">ì§„ë„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                        ${studentProgress.length > 5 ? `<div style="text-align: center; margin-top: 10px; color: #5c6bc0; font-size: 12px;">ì™¸ ${studentProgress.length - 5}ê°œ ë”ë³´ê¸°</div>` : ''}
                    </div>
                    
                    <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #ff4466;">
                        <h3 style="color: #ff4466; margin-bottom: 15px;">ğŸ“Š ìµœê·¼ í…ŒìŠ¤íŠ¸ <span style="background: #ff4466; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentEvals.length}</span></h3>
                        ${recentEvals.length > 0 ? recentEvals.map(e => `
                            <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #ff4466;">
                                ${e.category ? `<div style="color: #a0c8ff; font-size: 11px; margin-bottom: 3px;">${e.category}</div>` : ''}
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: bold; font-size: 13px;">${e.type}</span>
                                    <span style="background: ${e.score >= 90 ? '#00ff88' : e.score >= 80 ? '#ffd700' : '#ff4466'}; color: ${e.score >= 80 ? '#0a0e27' : 'white'}; padding: 3px 10px; border-radius: 5px; font-weight: bold;">${e.score}ì </span>
                                </div>
                                <div style="color: #a0a8c0; font-size: 11px;">${e.date}</div>
                            </div>
                        `).join('') : '<p style="color: #a0a8c0;">ì„±ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                        ${studentEvals.length > 5 ? `<div style="text-align: center; margin-top: 10px; color: #ff4466; font-size: 12px;">ì™¸ ${studentEvals.length - 5}ê°œ ë”ë³´ê¸°</div>` : ''}
                    </div>
                </div>
                
                ${studentComments.length > 0 ? `
                <div style="background: #0a0e27; padding: 20px; border-radius: 10px; border: 2px solid #ffaa00; margin-bottom: 30px;">
                    <h3 style="color: #ffaa00; margin-bottom: 15px;">ğŸ’¬ êµì‚¬ ì½”ë©˜íŠ¸ <span style="background: #ffaa00; color: #0a0e27; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${studentComments.length}</span></h3>
                    ${studentComments.slice(-3).reverse().map(c => `
                        <div style="background: #1a1f3a; padding: 12px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #ffaa00;">
                            <div style="display: flex; gap: 10px; margin-bottom: 5px;">
                                <span style="background: ${c.type === 'progress' ? '#5c6bc0' : '#ff4466'}; color: white; padding: 2px 8px; border-radius: 5px; font-size: 10px;">${c.type === 'progress' ? 'ì§„ë„' : 'ì„±ì '}</span>
                                <span style="color: #a0a8c0; font-size: 11px;">${c.date}</span>
                            </div>
                            <div style="color: white; font-size: 13px; line-height: 1.6;">${c.comment}</div>
                        </div>
                    `).join('')}
                    ${studentComments.length > 3 ? `<div style="text-align: center; margin-top: 10px; color: #ffaa00; font-size: 12px;">ì™¸ ${studentComments.length - 3}ê°œ ë”ë³´ê¸°</div>` : ''}
                </div>
                ` : ''}
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="color: rgba(0,0,0,0.7); font-size: 12px; margin-bottom: 5px;">ì´ ì§„ë„</div>
                        <div style="color: #0a0e27; font-size: 32px; font-weight: bold;">${studentProgress.length}íšŒ</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #5c6bc0 0%, #3f51b5 100%); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 5px;">ì´ í…ŒìŠ¤íŠ¸</div>
                        <div style="color: white; font-size: 32px; font-weight: bold;">${studentEvals.length}íšŒ</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ff4466 0%, #ff1744 100%); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 5px;">í‰ê·  ì ìˆ˜</div>
                        <div style="color: white; font-size: 32px; font-weight: bold;">${avgScore}ì </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%); padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="color: rgba(0,0,0,0.7); font-size: 12px; margin-bottom: 5px;">ì½”ë©˜íŠ¸</div>
                        <div style="color: #0a0e27; font-size: 32px; font-weight: bold;">${studentComments.length}ê°œ</div>
                    </div>
                </div>
            `;
            
            document.getElementById('workshopStudentsList').style.display = 'none';
            document.getElementById('workshopStudentDetail').innerHTML = html;
            document.getElementById('workshopStudentDetail').style.display = 'block';
        }
        
        // í•™ìƒ ì •ë ¬ í•¨ìˆ˜ (ê°€ë‚˜ë‹¤ìˆœ)
        function getSortedStudents() {
            return [...DB.students].sort((a, b) => a.name.localeCompare(b.name, 'ko-KR'));
        }
        
        // ì •ê·œ í•™ìƒ í•„í„°ë§ (ì£¼ 2íšŒ, ì£¼ 3íšŒ)
        function getRegularStudents() {
            return getSortedStudents().filter(s => s.weeklyFreq === '2' || s.weeklyFreq === '3' || s.weeklyFreq === 2 || s.weeklyFreq === 3);
        }
        
        // íŠ¹ê°• í•™ìƒ í•„í„°ë§
        function getWorkshopStudents() {
            return getSortedStudents().filter(s => 
                s.weeklyFreq === 'íŠ¹ê°•4' || s.weeklyFreq === 'íŠ¹ê°•8' || 
                s.weeklyFreq === 'íŠ¹ê°•12' || s.weeklyFreq === 'íŠ¹ê°•16' || 
                s.weeklyFreq === 'íŠ¹ê°•20'
            );
        }
        
        // íŠ¹ê°• ì²˜ë¦¬ í—¬í¼ í•¨ìˆ˜
        function getSessionCount(weeklyFreq) {
            if (weeklyFreq === 'íŠ¹ê°•4') return 4;
            if (weeklyFreq === 'íŠ¹ê°•8') return 8;
            if (weeklyFreq === 'íŠ¹ê°•12') return 12;
            if (weeklyFreq === 'íŠ¹ê°•16') return 16;
            if (weeklyFreq === 'íŠ¹ê°•20') return 20;
            const freq = parseInt(weeklyFreq);
            return freq === 2 ? 8 : 12;
        }
        
        function getFrequencyLabel(weeklyFreq) {
            if (weeklyFreq === 'íŠ¹ê°•4') return 'íŠ¹ê°• 4íšŒ';
            if (weeklyFreq === 'íŠ¹ê°•8') return 'íŠ¹ê°• 8íšŒ';
            if (weeklyFreq === 'íŠ¹ê°•12') return 'íŠ¹ê°• 12íšŒ';
            if (weeklyFreq === 'íŠ¹ê°•16') return 'íŠ¹ê°• 16íšŒ';
            if (weeklyFreq === 'íŠ¹ê°•20') return 'íŠ¹ê°• 20íšŒ';
            return `ì£¼ ${weeklyFreq}íšŒ`;
        }
        
        function addStudent() {
            const name = document.getElementById('addName').value.trim();
            const grade = document.getElementById('addGrade').value.trim();
            const freqValue = document.getElementById('addFreq').value;
            if (!name || !grade) { alert('ì´ë¦„ê³¼ í•™ë…„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            const id = DB.students.length > 0 ? Math.max(...DB.students.map(s => s.id)) + 1 : 1;
            DB.students.push({ id, name, grade, weeklyFreq: freqValue });
            
            document.getElementById('addName').value = '';
            document.getElementById('addGrade').value = '';
            const msg = document.getElementById('addSuccess');
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
            saveData();
            loadStudentManageTab();
        }
        
        function deleteStudent() {
            const studentId = parseInt(document.getElementById('deleteStudent').value);
            if (!studentId) { alert('ì‚­ì œí•  í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            const student = DB.students.find(s => s.id === studentId);
            if (!confirm(`${student.name} í•™ìƒì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            DB.students = DB.students.filter(s => s.id !== studentId);
            DB.studentTextbooks = DB.studentTextbooks.filter(st => st.studentId !== studentId);
            DB.progress = DB.progress.filter(p => p.studentId !== studentId);
            DB.evaluations = DB.evaluations.filter(e => e.studentId !== studentId);
            DB.comments = DB.comments.filter(c => c.studentId !== studentId);
            
            saveData();
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            loadStudentManageTab();
        }
        
        function loadStudentManageTab() {
            const select = document.getElementById('deleteStudent');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                getSortedStudents().map(s => `<option value="${s.id}">${s.name} (${s.grade})</option>`).join('');
        }
        
        function loadTextbookTab() {
            document.getElementById('txtStudent').innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' + 
                getSortedStudents().map(s => `<option value="${s.id}">${s.name} (${getFrequencyLabel(s.weeklyFreq)})</option>`).join('');
            document.getElementById('txtBook').innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                DB.textbooks.map(t => `<option value="${t.id}">${t.title}</option>`).join('');
            document.getElementById('txtStudentView').innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' + 
                getSortedStudents().map(s => `<option value="${s.id}">${s.name} (${s.grade})</option>`).join('');
        }
        
        function assignTextbook() {
            const studentId = parseInt(document.getElementById('txtStudent').value);
            const textbookId = parseInt(document.getElementById('txtBook').value);
            if (!studentId || !textbookId) { alert('í•™ìƒê³¼ êµì¬ë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
            
            const exists = DB.studentTextbooks.find(st => st.studentId === studentId && st.textbookId === textbookId);
            if (exists) { alert('ì´ë¯¸ ë“±ë¡ëœ êµì¬ì…ë‹ˆë‹¤'); return; }
            
            DB.studentTextbooks.push({ studentId, textbookId });
            saveData();
            alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // í˜„ì¬ ë³´ê³  ìˆëŠ” í•™ìƒì´ ìˆìœ¼ë©´ ìë™ ìƒˆë¡œê³ ì¹¨
            const currentViewStudent = document.getElementById('txtStudentView').value;
            if (currentViewStudent == studentId) {
                viewStudentTextbooks();
            }
        }
        
        function viewStudentTextbooks() {
            const studentId = parseInt(document.getElementById('txtStudentView').value);
            if (!studentId) {
                document.getElementById('studentTextbooksList').innerHTML = '';
                return;
            }
            
            const student = DB.students.find(s => s.id === studentId);
            const studentBooks = DB.studentTextbooks
                .filter(st => st.studentId === studentId)
                .map(st => {
                    const book = DB.textbooks.find(t => t.id === st.textbookId);
                    return { studentTextbookId: `${st.studentId}-${st.textbookId}`, ...st, bookTitle: book ? book.title : 'ì•Œ ìˆ˜ ì—†ìŒ' };
                });
            
            let html = '';
            if (studentBooks.length > 0) {
                html = `
                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff88; margin-bottom: 15px;">${student.name} í•™ìƒì˜ ë“±ë¡ êµì¬ (${studentBooks.length}ê°œ)</h4>
                        ${studentBooks.map(sb => `
                            <div class="item-row">
                                <div>
                                    <strong>${sb.bookTitle}</strong>
                                </div>
                                <div>
                                    <button class="btn btn-secondary btn-small" onclick="changeTextbook(${sb.studentId}, ${sb.textbookId})">ë³€ê²½</button>
                                    <button class="btn btn-danger btn-small" onclick="removeTextbook(${sb.studentId}, ${sb.textbookId})">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                html = '<p style="color: #a0a8c0; margin-top: 20px;">ë“±ë¡ëœ êµì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            
            document.getElementById('studentTextbooksList').innerHTML = html;
        }
        
        function changeTextbook(studentId, oldTextbookId) {
            const student = DB.students.find(s => s.id === studentId);
            const oldBook = DB.textbooks.find(t => t.id === oldTextbookId);
            
            // ëª¨ë‹¬ í˜•ì‹ìœ¼ë¡œ êµì¬ ì„ íƒ UI ìƒì„±
            const modalHtml = `
                <div id="changeTextbookModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center;">
                    <div style="background: #1a1f3a; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                        <h3 style="color: #00ff88; margin-bottom: 20px;">ğŸ“š êµì¬ ë³€ê²½</h3>
                        <p style="color: #a0a8c0; margin-bottom: 10px;">í•™ìƒ: <strong style="color: white;">${student.name}</strong></p>
                        <p style="color: #a0a8c0; margin-bottom: 20px;">í˜„ì¬ êµì¬: <strong style="color: #ff4466;">${oldBook.title}</strong></p>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="color: #a0a8c0; display: block; margin-bottom: 10px;">ë³€ê²½í•  êµì¬ ì„ íƒ:</label>
                            <select id="newTextbookSelect" style="width: 100%; padding: 12px; background: #0a0e27; border: 2px solid #00ff88; border-radius: 8px; color: white; font-size: 14px;">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                ${DB.textbooks.map(t => `
                                    <option value="${t.id}" ${t.id === oldTextbookId ? 'disabled' : ''}>
                                        ${t.title} ${t.id === oldTextbookId ? '(í˜„ì¬ êµì¬)' : ''}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="confirmChangeTextbook(${studentId}, ${oldTextbookId})" style="flex: 1; padding: 12px; background: #00ff88; border: none; border-radius: 8px; color: #0a0e27; font-weight: bold; cursor: pointer;">
                                âœ“ ë³€ê²½
                            </button>
                            <button onclick="closeChangeModal()" style="flex: 1; padding: 12px; background: #ff4466; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
                                âœ— ì·¨ì†Œ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function confirmChangeTextbook(studentId, oldTextbookId) {
            const newTextbookId = parseInt(document.getElementById('newTextbookSelect').value);
            
            if (!newTextbookId) {
                alert('ë³€ê²½í•  êµì¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            const student = DB.students.find(s => s.id === studentId);
            const oldBook = DB.textbooks.find(t => t.id === oldTextbookId);
            const newBook = DB.textbooks.find(t => t.id === newTextbookId);
            
            // ê¸°ì¡´ êµì¬ ì‚­ì œ
            DB.studentTextbooks = DB.studentTextbooks.filter(st => 
                !(st.studentId === studentId && st.textbookId === oldTextbookId)
            );
            
            // ìƒˆ êµì¬ ì¶”ê°€
            DB.studentTextbooks.push({ studentId, textbookId: newTextbookId });
            
            saveData();
            closeChangeModal();
            alert(`âœ… êµì¬ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n${student.name} í•™ìƒ\n${oldBook.title} â†’ ${newBook.title}`);
            viewStudentTextbooks();
        }
        
        function closeChangeModal() {
            const modal = document.getElementById('changeTextbookModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function removeTextbook(studentId, textbookId) {
            const student = DB.students.find(s => s.id === studentId);
            const book = DB.textbooks.find(t => t.id === textbookId);
            
            if (!confirm(`${student.name} í•™ìƒì˜ "${book.title}" êµì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            DB.studentTextbooks = DB.studentTextbooks.filter(st => 
                !(st.studentId === studentId && st.textbookId === textbookId)
            );
            
            saveData();
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            viewStudentTextbooks();
        }
        
        function loadProgressTab() {
            const select = document.getElementById('progStudent');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                getSortedStudents().map(s => `<option value="${s.id}">${s.name} - ${getFrequencyLabel(s.weeklyFreq)} (${getSessionCount(s.weeklyFreq)}íšŒ)</option>`).join('');
        }
        
        function loadProgressStudent() {
            const studentId = parseInt(document.getElementById('progStudent').value);
            if (!studentId) {
                document.getElementById('progressSessions').innerHTML = '';
                document.getElementById('progressCommentSection').style.display = 'none';
                return;
            }
            
            const student = DB.students.find(s => s.id === studentId);
            const maxSessions = getSessionCount(student.weeklyFreq);
            const studentProgress = DB.progress.filter(p => p.studentId === studentId);
            
            // í•™ìƒì˜ ë“±ë¡ êµì¬ ê°€ì ¸ì˜¤ê¸°
            const studentBooks = DB.studentTextbooks
                .filter(st => st.studentId === studentId)
                .map(st => {
                    const book = DB.textbooks.find(t => t.id === st.textbookId);
                    return book;
                })
                .filter(Boolean);
            
            let html = `<h4 style="margin: 20px 0;">ì›” ${maxSessions}íšŒ ì§„ë„ ì…ë ¥</h4>`;
            html += '<div class="progress-grid">';
            
            for (let i = 1; i <= maxSessions; i++) {
                const existing = studentProgress.find(p => p.sessionNum === i);
                const isCompleted = !!existing;
                
                html += `
                    <div class="progress-box ${isCompleted ? 'completed' : ''}" style="position: relative;">
                        <strong>${i}íšŒ</strong>
                        ${isCompleted ? `
                            <div style="font-size: 10px; margin-top: 5px; color: ${isCompleted ? '#0a0e27' : 'white'};">
                                ${existing.textbookTitle ? existing.textbookTitle.substring(0, 10) + '...' : ''}
                            </div>
                            <div style="font-size: 9px; margin-top: 2px;">${existing.content.substring(0, 12)}...</div>
                            <div style="margin-top: 8px; display: flex; gap: 4px; justify-content: center;">
                                <button onclick="editProgress(${studentId}, ${i})" style="background: #5c6bc0; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; flex: 1;">ìˆ˜ì •</button>
                                <button onclick="deleteProgress(${studentId}, ${i})" style="background: #ff4466; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; flex: 1;">ì‚­ì œ</button>
                            </div>
                        ` : `
                            <div onclick="document.getElementById('sessionNum').value=${i}; document.getElementById('sessionContent').focus();" style="cursor: pointer; color: #666; font-size: 11px; margin-top: 5px;">í´ë¦­í•˜ì—¬ ì…ë ¥</div>
                        `}
                    </div>
                `;
            }
            
            html += '</div>';
            
            // ë“±ë¡ëœ êµì¬ê°€ ìˆëŠ” ê²½ìš°
            if (studentBooks.length > 0) {
                html += `
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">ë“±ë¡ëœ êµì¬ (${studentBooks.length}ê°œ)</label>
                        <div style="background: #0a0e27; padding: 15px; border-radius: 8px;">
                            ${studentBooks.map(b => `
                                <div style="background: #1a1f3a; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #00ff88;">
                                    <strong>${b.title}</strong>
                                    <span style="color: #a0a8c0; font-size: 12px; margin-left: 10px;">(${b.units} units)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">íšŒì°¨ ì„ íƒ</label>
                    <select id="sessionNum" class="form-select">
                        ${Array.from({length: maxSessions}, (_, i) => `<option value="${i + 1}">${i + 1}íšŒ</option>`).join('')}
                    </select>
                </div>
            `;
            
            // êµì¬ ì„ íƒ ì¶”ê°€
            if (studentBooks.length > 0) {
                html += `
                    <div class="form-group">
                        <label class="form-label">êµì¬ ì„ íƒ</label>
                        <select id="sessionTextbook" class="form-select">
                            <option value="">êµì¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            ${studentBooks.map(b => `<option value="${b.id}">${b.title}</option>`).join('')}
                        </select>
                    </div>
                `;
            }
            
            html += `
                <div class="form-group">
                    <label class="form-label">í•™ìŠµ ë‚´ìš©</label>
                    <textarea id="sessionContent" class="form-textarea" placeholder="ì˜ˆ: Unit 1-3, Grammar: Present Perfect, Reading: Story 1
êµì¬ë¥¼ ì„ íƒí•˜ë©´ ë” ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ë‚ ì§œ</label>
                    <input type="date" id="sessionDate" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                </div>
                <button class="btn btn-primary" onclick="saveProgress()">ì§„ë„ ì €ì¥</button>
            `;
            
            document.getElementById('progressSessions').innerHTML = html;
            document.getElementById('progressCommentSection').style.display = 'block';
            loadProgressComments(studentId);
        }
        
        function viewProgressDetail(studentId, sessionNum) {
            const progress = DB.progress.find(p => p.studentId === studentId && p.sessionNum === sessionNum);
            if (!progress) return;
            
            const textbookName = progress.textbookTitle || 'êµì¬ ë¯¸ì§€ì •';
            
            alert(`ğŸ“– ${sessionNum}íšŒì°¨ ì§„ë„ ìƒì„¸\n\nêµì¬: ${textbookName}\ní•™ìŠµ ë‚´ìš©: ${progress.content}\në‚ ì§œ: ${progress.date}`);
        }
        
        function saveProgress() {
            const studentId = parseInt(document.getElementById('progStudent').value);
            const sessionNum = parseInt(document.getElementById('sessionNum').value);
            const content = document.getElementById('sessionContent').value.trim();
            const date = document.getElementById('sessionDate').value;
            
            const textbookSelect = document.getElementById('sessionTextbook');
            const textbookId = textbookSelect ? parseInt(textbookSelect.value) : null;
            
            let textbookTitle = null;
            if (textbookId) {
                const textbook = DB.textbooks.find(t => t.id === textbookId);
                textbookTitle = textbook ? textbook.title : null;
            }
            
            if (!content) { alert('í•™ìŠµ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            // ê¸°ì¡´ ì§„ë„ ì‚­ì œ í›„ ìƒˆë¡œ ì¶”ê°€
            DB.progress = DB.progress.filter(p => !(p.studentId === studentId && p.sessionNum === sessionNum));
            
            const progressData = {
                studentId,
                sessionNum,
                content,
                date
            };
            
            // êµì¬ ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
            if (textbookId) {
                progressData.textbookId = textbookId;
                progressData.textbookTitle = textbookTitle;
            }
            
            DB.progress.push(progressData);
            
            saveData();
            alert('âœ… ì§„ë„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadProgressStudent();
        }
        
        function editProgress(studentId, sessionNum) {
            const progress = DB.progress.find(p => p.studentId === studentId && p.sessionNum === sessionNum);
            if (!progress) return;
            
            // íšŒì°¨ ì„ íƒ
            document.getElementById('sessionNum').value = sessionNum;
            
            // êµì¬ ì„ íƒ (ìˆëŠ” ê²½ìš°)
            const textbookSelect = document.getElementById('sessionTextbook');
            if (textbookSelect && progress.textbookId) {
                textbookSelect.value = progress.textbookId;
            }
            
            // í•™ìŠµ ë‚´ìš©
            document.getElementById('sessionContent').value = progress.content;
            
            // ë‚ ì§œ
            document.getElementById('sessionDate').value = progress.date;
            
            // ìŠ¤í¬ë¡¤ì„ ì…ë ¥ í¼ìœ¼ë¡œ ì´ë™
            document.getElementById('sessionContent').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('sessionContent').focus();
        }
        
        function deleteProgress(studentId, sessionNum) {
            if (!confirm(`${sessionNum}íšŒ ì§„ë„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            DB.progress = DB.progress.filter(p => !(p.studentId === studentId && p.sessionNum === sessionNum));
            saveData();
            alert('âœ… ì§„ë„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadProgressStudent();
        }
        
        function loadProgressComments(studentId) {
            const comments = DB.comments.filter(c => c.studentId === studentId && c.type === 'progress');
            const html = comments.slice(-5).reverse().map(c => `
                <div class="comment-box">
                    <div class="comment-date">${c.date}</div>
                    <div class="comment-text">${c.comment}</div>
                </div>
            `).join('') || '<p style="color: #a0a8c0;">ì•„ì§ ì½”ë©˜íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('progressCommentList').innerHTML = html;
        }
        
        function saveProgressComment() {
            const studentId = parseInt(document.getElementById('progStudent').value);
            const comment = document.getElementById('progressComment').value.trim();
            
            if (!studentId || !comment) { alert('í•™ìƒì„ ì„ íƒí•˜ê³  ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            const id = DB.comments.length > 0 ? Math.max(...DB.comments.map(c => c.id)) + 1 : 1;
            DB.comments.push({
                id,
                studentId,
                type: 'progress',
                comment,
                date: new Date().toISOString().split('T')[0]
            });
            
            document.getElementById('progressComment').value = '';
            saveData();
            alert('ì½”ë©˜íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadProgressComments(studentId);
        }
        
        function loadEvalTab() {
            document.getElementById('evalStudent').innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                getSortedStudents().map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }
        
        function loadEvalComments() {
            const studentId = parseInt(document.getElementById('evalStudent').value);
            if (!studentId) {
                document.getElementById('evalCommentSection').style.display = 'none';
                document.getElementById('evalListSection').style.display = 'none';
                return;
            }
            
            // ì½”ë©˜íŠ¸ í‘œì‹œ
            document.getElementById('evalCommentSection').style.display = 'block';
            const comments = DB.comments.filter(c => c.studentId === studentId && c.type === 'evaluation');
            const html = comments.slice(-5).reverse().map(c => `
                <div class="comment-box">
                    <div class="comment-date">${c.date}</div>
                    <div class="comment-text">${c.comment}</div>
                </div>
            `).join('') || '<p style="color: #a0a8c0;">ì•„ì§ ì½”ë©˜íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('evalCommentList').innerHTML = html;
            
            // ì„±ì  ëª©ë¡ í‘œì‹œ
            document.getElementById('evalListSection').style.display = 'block';
            const evals = DB.evaluations.filter(e => e.studentId === studentId).sort((a, b) => new Date(b.date) - new Date(a.date));
            const evalHtml = evals.length > 0 ? evals.map(e => `
                <div style="background: #0a0e27; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid ${e.category === 'í•™êµì‹œí—˜' ? '#5c6bc0' : '#00ff88'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <span style="background: ${e.category === 'í•™êµì‹œí—˜' ? '#5c6bc0' : '#00ff88'}; color: white; padding: 4px 10px; border-radius: 5px; font-size: 11px; margin-right: 8px;">${e.category || 'í•™ì›TEST'}</span>
                            <span style="color: white; font-weight: bold; font-size: 14px;">${e.type}</span>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editEvaluation(${e.studentId}, '${e.type}', '${e.date}')" style="background: #5c6bc0; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer;">ìˆ˜ì •</button>
                            <button onclick="deleteEvaluation(${e.studentId}, '${e.type}', '${e.date}')" style="background: #ff4466; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #a0a8c0; font-size: 12px;">${e.date}</span>
                        <span style="background: ${e.score >= 90 ? '#00ff88' : e.score >= 80 ? '#ffd700' : '#ff4466'}; color: ${e.score >= 80 ? '#0a0e27' : 'white'}; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 16px;">${e.score}ì </span>
                    </div>
                </div>
            `).join('') : '<p style="color: #a0a8c0;">ë“±ë¡ëœ ì„±ì ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            document.getElementById('evalList').innerHTML = evalHtml;
        }
        
        function saveEvalComment() {
            const studentId = parseInt(document.getElementById('evalStudent').value);
            const comment = document.getElementById('evalComment').value.trim();
            
            if (!studentId || !comment) { alert('í•™ìƒì„ ì„ íƒí•˜ê³  ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            const id = DB.comments.length > 0 ? Math.max(...DB.comments.map(c => c.id)) + 1 : 1;
            DB.comments.push({
                id,
                studentId,
                type: 'evaluation',
                comment,
                date: new Date().toISOString().split('T')[0]
            });
            
            document.getElementById('evalComment').value = '';
            saveData();
            alert('ì½”ë©˜íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadEvalComments();
        }
        
        function saveSchoolExam() {
            const studentId = parseInt(document.getElementById('evalStudent').value);
            const type = document.getElementById('schoolExamType').value;
            const score = parseInt(document.getElementById('schoolExamScore').value);
            const date = document.getElementById('schoolExamDate').value;
            
            if (!studentId) { alert('í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            if (!type) { alert('ì‹œí—˜ êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            if (!score && score !== 0) { alert('ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            if (score < 0 || score > 100) { alert('ì ìˆ˜ëŠ” 0-100 ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            DB.evaluations.push({ 
                studentId, 
                category: 'í•™êµì‹œí—˜',
                type: type,
                date, 
                score 
            });
            
            saveData();
            alert('âœ… í•™êµ ì‹œí—˜ ì„±ì ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('schoolExamType').value = '';
            document.getElementById('schoolExamScore').value = '';
            document.getElementById('schoolExamDate').value = new Date().toISOString().split('T')[0];
            
            // ì„±ì  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            loadEvalComments();
        }
        
        function saveAcademyTest() {
            const studentId = parseInt(document.getElementById('evalStudent').value);
            const type = document.getElementById('academyTestType').value;
            const score = parseInt(document.getElementById('academyTestScore').value);
            const date = document.getElementById('academyTestDate').value;
            
            if (!studentId) { alert('í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            if (!type) { alert('TEST êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            if (!score && score !== 0) { alert('ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            if (score < 0 || score > 100) { alert('ì ìˆ˜ëŠ” 0-100 ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            DB.evaluations.push({ 
                studentId, 
                category: 'í•™ì›TEST',
                type: type,
                date, 
                score 
            });
            
            saveData();
            alert('âœ… í•™ì› TEST ì„±ì ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('academyTestType').value = '';
            document.getElementById('academyTestScore').value = '';
            document.getElementById('academyTestDate').value = new Date().toISOString().split('T')[0];
            
            // ì„±ì  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            loadEvalComments();
        }
        
        function editEvaluation(studentId, type, date) {
            const evaluation = DB.evaluations.find(e => e.studentId === studentId && e.type === type && e.date === date);
            if (!evaluation) return;
            
            // í•™êµì‹œí—˜ vs í•™ì›TEST êµ¬ë¶„
            if (evaluation.category === 'í•™êµì‹œí—˜') {
                document.getElementById('schoolExamType').value = type;
                document.getElementById('schoolExamScore').value = evaluation.score;
                document.getElementById('schoolExamDate').value = date;
                
                // ìŠ¤í¬ë¡¤
                document.getElementById('schoolExamType').scrollIntoView({ behavior: 'smooth' });
            } else {
                document.getElementById('academyTestType').value = type;
                document.getElementById('academyTestScore').value = evaluation.score;
                document.getElementById('academyTestDate').value = date;
                
                // ìŠ¤í¬ë¡¤
                document.getElementById('academyTestType').scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function deleteEvaluation(studentId, type, date) {
            if (!confirm(`${type} ì„±ì ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            DB.evaluations = DB.evaluations.filter(e => !(e.studentId === studentId && e.type === type && e.date === date));
            saveData();
            alert('âœ… ì„±ì ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            loadEvalComments();
        }
        
        function handleEvalType() {
            const type = document.getElementById('evalType').value;
            let html = '';
            if (type) {
                html = `
                    <div class="form-group">
                        <label class="form-label">ì´ì </label>
                        <input type="number" id="evalScore" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‚ ì§œ</label>
                        <input type="date" id="evalDate" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                `;
            }
            document.getElementById('evalFields').innerHTML = html;
        }
        
        function saveEvaluation() {
            const studentId = parseInt(document.getElementById('evalStudent').value);
            const category = document.getElementById('evalCategory').value;
            const type = document.getElementById('evalType').value;
            const score = parseInt(document.getElementById('evalScore').value);
            const date = document.getElementById('evalDate').value;
            
            if (!studentId || !type || !score) { 
                alert('í•™ìƒ, í‰ê°€ í•­ëª©, ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); 
                return; 
            }
            
            DB.evaluations.push({ 
                studentId, 
                category: category || 'ê¸°íƒ€',
                type, 
                date, 
                score 
            });
            
            saveData();
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('evalCategory').value = '';
            document.getElementById('evalType').value = '';
            document.getElementById('evalFields').innerHTML = '';
        }
        
        function loadAdminTab() {
            const html = DB.textbooks.map(t => `
                <div class="item-row">
                    <div>${t.title} (${t.units} units)</div>
                    <button class="btn btn-danger btn-small" onclick="deleteTextbook(${t.id})">ì‚­ì œ</button>
                </div>
            `).join('');
            document.getElementById('textbooksList').innerHTML = html;
        }
        
        function addTextbook() {
            const title = document.getElementById('adminBookTitle').value.trim();
            const units = parseInt(document.getElementById('adminBookUnits').value);
            if (!title || !units) { alert('êµì¬ëª…ê³¼ Unit ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            const id = DB.textbooks.length > 0 ? Math.max(...DB.textbooks.map(t => t.id)) + 1 : 1;
            DB.textbooks.push({ id, title, units });
            document.getElementById('adminBookTitle').value = '';
            document.getElementById('adminBookUnits').value = '';
            saveData();
            loadAdminTab();
            alert('êµì¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function deleteTextbook(textbookId) {
            const textbook = DB.textbooks.find(t => t.id === textbookId);
            if (!confirm(`${textbook.title} êµì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            DB.textbooks = DB.textbooks.filter(t => t.id !== textbookId);
            DB.studentTextbooks = DB.studentTextbooks.filter(st => st.textbookId !== textbookId);
            
            saveData();
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            loadAdminTab();
        }
        
        // ë°ì´í„° ë°±ì—… ê¸°ëŠ¥
        function exportData() {
            const data = localStorage.getItem('academyDB');
            const blob = new Blob([data || JSON.stringify(DB)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `academy_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ë°ì´í„° í…ìŠ¤íŠ¸ë¡œ ë³´ê¸°
        function showDataText() {
            const dataDisplay = document.getElementById('dataDisplay');
            const textarea = document.getElementById('dataTextarea');
            const data = localStorage.getItem('academyDB') || JSON.stringify(DB, null, 2);
            textarea.value = data;
            dataDisplay.style.display = 'block';
        }
        
        // ë°ì´í„° ë³µì‚¬
        function copyData() {
            const textarea = document.getElementById('dataTextarea');
            textarea.select();
            document.execCommand('copy');
            alert('âœ… ë°ì´í„°ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function saveData() {
            localStorage.setItem('academyDB', JSON.stringify(DB));
        }
        
        function loadData() {
            const saved = localStorage.getItem('academyDB');
            if (saved) {
                Object.assign(DB, JSON.parse(saved));
                
                // íŠ¹ê°• ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (101, 102 ë“± -> íŠ¹ê°•4, íŠ¹ê°•8 ë“±)
                DB.students.forEach(student => {
                    if (student.weeklyFreq === 101) student.weeklyFreq = 'íŠ¹ê°•4';
                    else if (student.weeklyFreq === 102) student.weeklyFreq = 'íŠ¹ê°•8';
                    else if (student.weeklyFreq === 103) student.weeklyFreq = 'íŠ¹ê°•12';
                    else if (student.weeklyFreq === 104) student.weeklyFreq = 'íŠ¹ê°•16';
                    else if (student.weeklyFreq === 105) student.weeklyFreq = 'íŠ¹ê°•20';
                    else if (typeof student.weeklyFreq === 'number') {
                        student.weeklyFreq = student.weeklyFreq.toString();
                    }
                });
                
                saveData(); // ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ì €ì¥
            }
        }
        
        // ì›”ë§ ë¦¬í¬íŠ¸ ìƒì„± (2í˜ì´ì§€ ë¶„ë¦¬ - ì˜ë¦¼ ë°©ì§€)
        
        // ì›”ë§ ë¦¬í¬íŠ¸ ìƒì„± (2í˜ì´ì§€ ì™„ì „ ë¶„ë¦¬ - ì˜ë¦¼ ë°©ì§€)
        function generateMonthlyReport(studentId) {
            const student = DB.students.find(s => s.id === studentId);
            if (!student) { alert('í•™ìƒ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
            
            const today = new Date();
            const reportMonth = today.getMonth();
            const reportYear = today.getFullYear();
            const maxSessions = getSessionCount(student.weeklyFreq);
            
            // íŠ¹ê°• í•™ìƒ ì—¬ë¶€ í™•ì¸
            const isWorkshop = student.weeklyFreq === 'íŠ¹ê°•4' || student.weeklyFreq === 'íŠ¹ê°•8' || 
                               student.weeklyFreq === 'íŠ¹ê°•12' || student.weeklyFreq === 'íŠ¹ê°•16' || 
                               student.weeklyFreq === 'íŠ¹ê°•20';
            
            // íŠ¹ê°• í•™ìƒì€ ì „ì²´ ê¸°ê°„, ì •ê·œ í•™ìƒì€ ì´ë²ˆ ë‹¬ë§Œ
            const monthlyProgress = isWorkshop 
                ? DB.progress.filter(p => p.studentId === studentId).sort((a, b) => a.sessionNum - b.sessionNum)
                : DB.progress.filter(p => {
                    if (p.studentId !== studentId) return false;
                    const pDate = new Date(p.date);
                    return pDate.getMonth() === reportMonth && pDate.getFullYear() === reportYear;
                  }).sort((a, b) => a.sessionNum - b.sessionNum);
            
            const monthlyEvals = isWorkshop
                ? DB.evaluations.filter(e => e.studentId === studentId)
                : DB.evaluations.filter(e => {
                    if (e.studentId !== studentId) return false;
                    const eDate = new Date(e.date);
                    return eDate.getMonth() === reportMonth && eDate.getFullYear() === reportYear;
                  });
            
            const monthlyComments = isWorkshop
                ? DB.comments.filter(c => c.studentId === studentId)
                : DB.comments.filter(c => {
                    if (c.studentId !== studentId) return false;
                    const cDate = new Date(c.date);
                    return cDate.getMonth() === reportMonth && cDate.getFullYear() === reportYear;
                  });
            
            const studentBooks = DB.studentTextbooks
                .filter(st => st.studentId === studentId)
                .map(st => DB.textbooks.find(t => t.id === st.textbookId)?.title)
                .filter(Boolean);
            
            // ì „ì²´ íšŒì°¨ ë°°ì—´ ìƒì„± (ë¹ˆì¹¸ í¬í•¨)
            const allSessions = [];
            for (let i = 1; i <= maxSessions; i++) {
                const existing = monthlyProgress.find(p => p.sessionNum === i);
                if (existing) {
                    allSessions.push(existing);
                } else {
                    allSessions.push({
                        sessionNum: i,
                        date: '-',
                        textbookTitle: '-',
                        content: '-'
                    });
                }
            }
            
            // 1í˜ì´ì§€ HTML
            const page1HTML = `
                <div id="pdfPage1" style="background: white; padding: 40px; width: 750px; min-height: 1050px; font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif; color: #1a237e;">
                    <div style="text-align: center; background: #1a237e; padding: 30px; margin-bottom: 30px;">
                        <h1 style="color: #e8d5b7; font-size: 32px; margin: 0 0 10px 0; font-weight: 900;">ê°•íƒœë¦°ì˜ì–´</h1>
                        <p style="color: #e8d5b7; font-size: 14px; margin: 0;">KANGTAERIN ENGLISH ACADEMY</p>
                        <p style="color: #a0c8ff; font-size: 12px; margin: 10px 0 0 0;">Monthly Progress Report</p>
                    </div>
                    
                    <h2 style="text-align: center; color: #1a237e; font-size: 24px; margin: 0 0 30px 0; font-weight: 700;">${isWorkshop ? 'íŠ¹ê°• ë¦¬í¬íŠ¸' : `${reportYear}ë…„ ${reportMonth + 1}ì›” ì›”ë§ ë¦¬í¬íŠ¸`}</h2>
                    
                    <div style="background: #f5f7ff; padding: 20px; margin-bottom: 30px; border-left: 5px solid #1a237e;">
                        <table style="width: 100%; font-size: 14px; line-height: 1.8;">
                            <tr>
                                <td style="font-weight: bold; width: 150px;">í•™ìƒ ì´ë¦„</td>
                                <td>${student.name}</td>
                                <td style="font-weight: bold; width: 150px;">í•™ë…„</td>
                                <td>${student.grade}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">ë“±ë¡ ìœ í˜•</td>
                                <td>${getFrequencyLabel(student.weeklyFreq)} (ì´ ${maxSessions}íšŒ)</td>
                                <td style="font-weight: bold;">ì‘ì„±ì¼</td>
                                <td>${reportYear}. ${reportMonth + 1}. ${today.getDate()}.</td>
                            </tr>
                        </table>
                    </div>
                    
                    ${studentBooks.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #1a237e; font-size: 18px; border-bottom: 2px solid #1a237e; padding-bottom: 10px; margin-bottom: 15px; font-weight: 700;">ë“±ë¡ êµì¬</h3>
                        ${studentBooks.map(book => `
                            <div style="background: white; border: 1px solid #c5cae9; padding: 10px; margin-bottom: 6px; font-size: 12px;">
                                ${book}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #1a237e; font-size: 18px; border-bottom: 2px solid #1a237e; padding-bottom: 10px; margin-bottom: 15px; font-weight: 700;">
                            ${isWorkshop ? 'ì „ì²´ í•™ìŠµ ì§„ë„' : 'ì´ë²ˆ ë‹¬ í•™ìŠµ ì§„ë„'} (${monthlyProgress.length} / ${maxSessions}íšŒ ì™„ë£Œ)
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; font-size: 10px;">
                            <thead>
                                <tr style="background: #1a237e; color: white;">
                                    <th style="padding: 8px; text-align: center; width: 45px;">íšŒì°¨</th>
                                    <th style="padding: 8px; text-align: center; width: 80px;">ë‚ ì§œ</th>
                                    <th style="padding: 8px; text-align: left; width: 150px;">êµì¬</th>
                                    <th style="padding: 8px; text-align: left;">í•™ìŠµ ë‚´ìš©</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allSessions.map((session, idx) => `
                                    <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                                        <td style="padding: 8px; text-align: center; border: 1px solid #e0e0e0; font-weight: bold;">${session.sessionNum}íšŒ</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #e0e0e0; font-size: 9px; color: ${session.date === '-' ? '#ccc' : '#000'};">${session.date}</td>
                                        <td style="padding: 8px; border: 1px solid #e0e0e0; color: ${session.textbookTitle === '-' ? '#ccc' : '#5c6bc0'}; font-size: 9px;">${session.textbookTitle}</td>
                                        <td style="padding: 8px; border: 1px solid #e0e0e0; color: ${session.content === '-' ? '#ccc' : '#000'};">${session.content}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // 2í˜ì´ì§€ HTML
            const page2HTML = `
                <div id="pdfPage2" style="background: white; padding: 40px; width: 750px; min-height: 1050px; font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif; color: #1a237e;">
                    <h2 style="text-align: center; color: #1a237e; font-size: 24px; margin: 0 0 30px 0; font-weight: 700;">${isWorkshop ? 'íŠ¹ê°• ë¦¬í¬íŠ¸ (2/2)' : `${reportYear}ë…„ ${reportMonth + 1}ì›” ì›”ë§ ë¦¬í¬íŠ¸ (2/2)`}</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #1a237e; font-size: 18px; border-bottom: 2px solid #1a237e; padding-bottom: 10px; margin-bottom: 15px; font-weight: 700;">${isWorkshop ? 'ì „ì²´ ì„±ì ' : 'ì´ë²ˆ ë‹¬ ì„±ì '}</h3>
                        ${monthlyEvals.length > 0 ? `
                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                <thead>
                                    <tr style="background: #1a237e; color: white;">
                                        <th style="padding: 10px; text-align: left;">í‰ê°€ êµ¬ë¶„</th>
                                        <th style="padding: 10px; text-align: left;">í‰ê°€ í•­ëª©</th>
                                        <th style="padding: 10px; text-align: center; width: 90px;">ì ìˆ˜</th>
                                        <th style="padding: 10px; text-align: center; width: 90px;">ë‚ ì§œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${monthlyEvals.map((e, idx) => `
                                        <tr style="background: ${idx % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                                            <td style="padding: 10px; border: 1px solid #e0e0e0; color: #5c6bc0; font-weight: bold;">${e.category || '-'}</td>
                                            <td style="padding: 10px; border: 1px solid #e0e0e0;">${e.type}</td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0; font-weight: bold; color: #1a237e;">${e.score}ì </td>
                                            <td style="padding: 10px; text-align: center; border: 1px solid #e0e0e0;">${e.date}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : `
                            <div style="text-align: center; padding: 40px; color: #999; background: #f9f9f9;">
                                ${isWorkshop ? 'ì„±ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.' : 'ì´ë²ˆ ë‹¬ ì„±ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.'}
                            </div>
                        `}
                    </div>
                    
                    ${monthlyComments.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #1a237e; font-size: 18px; border-bottom: 2px solid #1a237e; padding-bottom: 10px; margin-bottom: 15px; font-weight: 700;">êµì‚¬ ì½”ë©˜íŠ¸</h3>
                        ${monthlyComments.map((c, idx) => `
                            <div style="background: ${idx % 2 === 0 ? '#f5f7ff' : '#ffffff'}; padding: 15px; margin-bottom: 10px; border-left: 4px solid #ffaa00;">
                                <div style="color: #666; font-size: 11px; margin-bottom: 5px;">${c.date} - ${c.type === 'progress' ? 'ì§„ë„ ê´€ë ¨' : 'ì„±ì  ê´€ë ¨'}</div>
                                <div style="color: #1a237e; line-height: 1.6;">${c.comment}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 50px; padding: 20px; background: #f5f7ff; font-size: 12px; color: #666; text-align: center;">
                        <p style="margin: 0; font-weight: bold;">ë³¸ ë¦¬í¬íŠ¸ëŠ” ë§¤ì›” 5ì¼ì— ë°œì†¡ë©ë‹ˆë‹¤.</p>
                        <p style="margin: 5px 0 0 0;">ê°•íƒœë¦°ì˜ì–´ í•™ì›</p>
                    </div>
                </div>
            `;
            
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '0';
            tempDiv.style.top = '0';
            tempDiv.style.zIndex = '-1';
            tempDiv.innerHTML = page1HTML + page2HTML;
            document.body.appendChild(tempDiv);
            
            setTimeout(function() {
                Promise.all([
                    html2canvas(document.getElementById('pdfPage1'), {
                        scale: 2,
                        backgroundColor: '#ffffff',
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    }),
                    html2canvas(document.getElementById('pdfPage2'), {
                        scale: 2,
                        backgroundColor: '#ffffff',
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    })
                ]).then(function(canvases) {
                    try {
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const pdfWidth = 210;
                        const pdfHeight = 297;
                        
                        const canvas1 = canvases[0];
                        const imgData1 = canvas1.toDataURL('image/png', 1.0);
                        const imgWidth1 = pdfWidth;
                        const imgHeight1 = (canvas1.height * pdfWidth) / canvas1.width;
                        pdf.addImage(imgData1, 'PNG', 0, 0, imgWidth1, Math.min(imgHeight1, pdfHeight), undefined, 'FAST');
                        
                        const canvas2 = canvases[1];
                        const imgData2 = canvas2.toDataURL('image/png', 1.0);
                        const imgWidth2 = pdfWidth;
                        const imgHeight2 = (canvas2.height * pdfWidth) / canvas2.width;
                        pdf.addPage();
                        pdf.addImage(imgData2, 'PNG', 0, 0, imgWidth2, Math.min(imgHeight2, pdfHeight), undefined, 'FAST');
                        
                        document.body.removeChild(tempDiv);
                        
                        const filename = `${student.name}_${reportYear}ë…„${reportMonth + 1}ì›”_ì›”ë§ë¦¬í¬íŠ¸.pdf`;
                        pdf.save(filename);
                        
                        alert('âœ… ì›”ë§ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        
                    } catch (error) {
                        console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                        document.body.removeChild(tempDiv);
                        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + error.message);
                    }
                }).catch(function(error) {
                    console.error('Canvas ë³€í™˜ ì˜¤ë¥˜:', error);
                    document.body.removeChild(tempDiv);
                    alert('ì´ë¯¸ì§€ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nChrome ë˜ëŠ” Edge ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                });
            }, 500);
        }
        
        // íŠ¹ê°• ë¦¬í¬íŠ¸ ìƒì„± (íŠ¹ê°• ì „ìš©)
        function generateWorkshopReport(studentId) {
            alert('íŠ¹ê°• ë¦¬í¬íŠ¸ëŠ” ì›”ë§ ë¦¬í¬íŠ¸ì™€ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.');
            generateMonthlyReport(studentId);
        }
        
        // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  í•¨ìˆ˜
        function shareToKakao(studentId) {
            const student = DB.students.find(s => s.id === studentId);
            if (!student) return;
            
            const today = new Date();
            const reportMonth = today.getMonth();
            const reportYear = today.getFullYear();
            
            // íŠ¹ê°• í•™ìƒ ì—¬ë¶€ í™•ì¸
            const isWorkshop = student.weeklyFreq === 'íŠ¹ê°•4' || student.weeklyFreq === 'íŠ¹ê°•8' || 
                               student.weeklyFreq === 'íŠ¹ê°•12' || student.weeklyFreq === 'íŠ¹ê°•16' || 
                               student.weeklyFreq === 'íŠ¹ê°•20';
            
            const monthlyProgress = isWorkshop 
                ? DB.progress.filter(p => p.studentId === studentId)
                : DB.progress.filter(p => {
                    if (p.studentId !== studentId) return false;
                    const pDate = new Date(p.date);
                    return pDate.getMonth() === reportMonth && pDate.getFullYear() === reportYear;
                  });
            
            const monthlyEvals = isWorkshop
                ? DB.evaluations.filter(e => e.studentId === studentId)
                : DB.evaluations.filter(e => {
                    if (e.studentId !== studentId) return false;
                    const eDate = new Date(e.date);
                    return eDate.getMonth() === reportMonth && eDate.getFullYear() === reportYear;
                  });
            
            const avgScore = monthlyEvals.length > 0 
                ? Math.round(monthlyEvals.reduce((sum, e) => sum + e.score, 0) / monthlyEvals.length) 
                : 0;
            
            const maxSessions = getSessionCount(student.weeklyFreq);
            
            // ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ í…œí”Œë¦¿
            if (Kakao && Kakao.Share) {
                Kakao.Share.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: `ğŸ“š ${isWorkshop ? 'íŠ¹ê°• ë¦¬í¬íŠ¸' : reportYear + 'ë…„ ' + (reportMonth + 1) + 'ì›” ì›”ë§ ë¦¬í¬íŠ¸'}`,
                        description: `${student.name} (${student.grade})\n` +
                                   `ë“±ë¡ ìœ í˜•: ${getFrequencyLabel(student.weeklyFreq)}\n` +
                                   `ì§„ë„: ${monthlyProgress.length}/${maxSessions}íšŒ ì™„ë£Œ\n` +
                                   `í‰ê·  ì ìˆ˜: ${avgScore > 0 ? avgScore + 'ì ' : 'ë¯¸í‰ê°€'}\n\n` +
                                   `ğŸ“„ ìì„¸í•œ ë‚´ìš©ì€ PDF ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!`,
                        imageUrl: 'https://mud-kage.kakao.com/dn/NTmhS/btqfEUdFAUf/FjKzkZsnoeE4o19klTOVI1/openlink_640x640s.jpg',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    },
                    buttons: [
                        {
                            title: 'ìƒì„¸ ë³´ê¸°',
                            link: {
                                mobileWebUrl: window.location.href,
                                webUrl: window.location.href
                            }
                        }
                    ]
                });
            } else {
                alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì¹´ì¹´ì˜¤í†¡ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }
        
        
        document.addEventListener('DOMContentLoaded', () => {
            // ì¹´ì¹´ì˜¤í†¡ SDK ì´ˆê¸°í™”
            if (Kakao && !Kakao.isInitialized()) {
                Kakao.init('581105d1ce5476d1e1ed5e7e3a24e236');
                console.log('ì¹´ì¹´ì˜¤í†¡ SDK ì´ˆê¸°í™” ì™„ë£Œ');
            }
            
            document.getElementById('loginPassword').addEventListener('keypress', e => {
                if (e.key === 'Enter') login();
            });
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                showApp();
            }
        });
    </script>
</body>
</html>
